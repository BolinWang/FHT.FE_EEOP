webpackJsonp([33],{CR0I:function(e,t,a){var s=a("Vq5T");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a("8bSs")("63bcd051",s,!0)},"JX/D":function(e,t,a){var s=a("Alxp")(a("aV7r"),a("nySD"),function(e){a("CR0I")},"data-v-52461094",null);e.exports=s.exports},Vq5T:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,'.map-address-select[data-v-52461094]{width:100%}.map-selected-container[data-v-52461094]{position:relative;width:660px;height:400px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.map-selected-container .bm-container[data-v-52461094]{width:400px;height:400px}.map-selected-container .bm-container .bm-view[data-v-52461094]{width:400px;height:400px;background-color:red}.map-selected-container .bm-container .search-input[data-v-52461094]{position:absolute;top:10px;left:10px;width:340px}.map-selected-container .search-list[data-v-52461094]{width:250px;height:400px;overflow-x:hidden;overflow-y:scroll}.map-selected-container .search-list .search-list-item[data-v-52461094]{display:block;line-height:1;padding:8px 15px}.map-selected-container .search-list .search-list-item[data-v-52461094]:hover{background-color:hsla(0,0%,94%,.8)}.map-selected-container .search-list .address[data-v-52461094]{margin:0;color:#999;font-size:12px}.map-selected-container .search-list .title[data-v-52461094]{margin:0 0 5px;font-size:14px;color:#333}.map-selected-container .selected-point[data-v-52461094]{position:absolute;top:200px;left:200px;width:0;height:0;visibility:hidden}.selected-house-position .form-item[data-v-52461094]{position:relative;margin-bottom:10px}.selected-house-position .form-item .city-label[data-v-52461094]:before{content:"*";color:#f56c6c;margin-right:4px}.selected-house-position .city-name[data-v-52461094]{margin:0}.selected-house-position .close-icon[data-v-52461094]{position:absolute;top:12px;right:12px;z-index:10;cursor:pointer;font-size:18px;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s}.selected-house-position .close-icon[data-v-52461094]:hover{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.map-selected-tips[data-v-52461094]{margin-top:-20px;margin-bottom:10px}.map-selected-tips p[data-v-52461094]{font-size:12px;margin:0;color:red}',""])},aV7r:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("4YfN"),i=a.n(s),r=a("ZLEe"),o=a.n(r),n=a("aA9S"),l=a.n(n),d=a("QHcW"),c=a("M9cN"),p=a.n(c),m=a("0xDb");t.default={name:"map-select",props:{areaCode:{type:Array,default:[]},value:{type:String,default:""}},data:function(){return{specificAddress:"",loading:!1,addressList:[],mapModelVisible:!1,searchKeywords:"",searchResult:[],map:null,local:null,mapSelectForm:{},mapSelectFormRules:{region:[{required:!0,message:"请选择所在区域",trigger:"change"}],name:[{required:!0,message:"请输入小区名称",trigger:"blur"}],address:[{required:!0,message:"请输入具体地址",trigger:"blur"}]},tempAreaCode:[],tempMapData:{},regionOptions:[]}},methods:{fetchAddressList:function(e){var t=this;""!==e?(this.loading=!0,Object(d.f)({cityId:Number(this.areaCode[1])||330100,keyword:e}).then(function(e){t.loading=!1,t.addressList=[],"0"===e.code&&e.data.list&&(e.data.list.forEach(function(e,t){e.formatName=e.name.replace(/<span(.*?)>/g,"").replace(/<\/span>/g,"")+" - "+e.address,e.displayText=e.name+" - "+e.address}),t.addressList=e.data.list),t.addressList.push({formatName:"",cityId:"-1",displayText:'<span style="color: red">找不到小区？点击这里添加小区</span>'})})):this.addressList=[]},checkAddressSelect:function(e){this.areaCode[2]||(this.$message.error("请先选择所在地区"),e.target.blur())},setAddress:function(e){e&&("-1"===e.cityId?(this.specificAddress="",this.mapModelVisible=!0,this.$set(this,"mapSelectForm",{city:"",name:"",region:"",address:""})):e.areaId!==this.areaCode[2]?this.$emit("addressChange",{zoneId:"",areaCode:[e.provinceId,e.cityId,e.areaId],address:e.formatName,regionAddressId:e.regionAddressId||""}):this.$emit("addressChange",{address:e.formatName,regionAddressId:e.regionAddressId||""}),this.addressList=[])},initBMap:function(){var e=this,t=this,a="",s=p.a.filter(function(t){return t.value===e.tempAreaCode[0]});s[0]&&s[0].children&&(a=s[0].label,this.mapSelectForm.city=a,this.regionOptions=s[0].children.filter(function(t){return t.value===e.tempAreaCode[1]})[0].children);var i=this.regionOptions.filter(function(t){return t.value===e.tempAreaCode[2]});i[0]&&(a+=i[0].label),t.map=new BMap.Map("bm-view",{minZoom:13,maxZoom:19}),t.map.centerAndZoom(a||"杭州市",15),t.map.enableScrollWheelZoom(!0),t.map.addEventListener("click",function(e){t.setMapPosition(e.point)});var r={onSearchComplete:function(e){if(t.local.getStatus()===BMAP_STATUS_SUCCESS){t.searchResult=[];for(var a=0;a<e.getCurrentNumPois();a++)t.searchResult.push(e.getPoi(a))}}};t.local=new BMap.LocalSearch(t.map,r)},searchPositionByKeywords:function(){this.local.search(this.searchKeywords)},setMapPosition:function(e,t){var a=this;t&&this.$set(this,"mapSelectForm",l()(this.mapSelectForm,{baiduUid:t.uid,longitude:t.point.lng+"",latitude:t.point.lat+"",address:t.address}));var s=new BMap.Point(e.lng,e.lat),i=new BMap.Marker(s),r=new BMap.Geocoder;this.map.clearOverlays(),this.map.addOverlay(i),this.map.panTo(s),this.map.setZoom(15),r.getLocation(s,function(e){var s=e.addressComponents;if(s.city!==a.mapSelectForm.city){a.mapSelectForm.city=s.city;var i=p.a.filter(function(e){return e.label===s.province});if(i[0]&&i[0].children){a.tempAreaCode[0]=i[0].value;var r=i[0].children.filter(function(e){return e.label===s.city});r[0]&&r[0].children&&(a.tempAreaCode[1]=r[0].value,a.regionOptions=r[0].children)}}t?a.mapSelectForm.name=t.title:a.$set(a,"mapSelectForm",l()(a.mapSelectForm,{name:e.surroundingPois[0]?e.surroundingPois[0].title:e.address,address:e.address,longitude:e.point.lng+"",latitude:e.point.lat+""})),a.regionOptions.forEach(function(e){e.label===s.district&&(a.mapSelectForm.region=e.value)}),a.tempMapData=Object(m.d)(a.mapSelectForm)}),this.$refs.popover.doShow()},closeMapModel:function(e){var t=this;"save"===e?this.$refs.mapSelectForm.validate(function(e){if(!e)return console.log(e),t.$message.error("您还有必填信息未填写完全，请全部填写好后再保存"),!1;t.addEstateSubdistrict(0)}):this.mapModelVisible=!1},addEstateSubdistrict:function(e){var t=this,a=1;0===(e=e||0)?o()(this.mapSelectForm).forEach(function(e){t.mapSelectForm[e]!==t.tempMapData[e]&&(a=5)}):a=5;var s={provinceId:this.tempAreaCode[0],cityId:this.tempAreaCode[1],regionId:this.tempAreaCode[2],source:a,confirmStatus:e};Object(d.k)(i()({},this.mapSelectForm,s)).then(function(e){var a=e.data;1!==a.confirmStatus?(t.mapModelVisible=!1,t.tempAreaCode[2]!==t.areaCode[2]?t.$emit("addressChange",{areaCode:t.tempAreaCode,address:t.mapSelectForm.name+" - "+t.mapSelectForm.address,regionAddressId:a.regionAddressId,zoneId:""}):t.$emit("addressChange",{address:t.mapSelectForm.name+" - "+t.mapSelectForm.address,regionAddressId:a.regionAddressId})):t.$confirm('新选择的小区名称、区域、具体地址和历史录入的一致，<span style="color:red">但经纬度坐标不一致</span>，是否使用新坐标并覆盖？',"再次确定",{dangerouslyUseHTMLString:!0,distinguishCancelAndClose:!0,confirmButtonText:"使用新地址",cancelButtonText:"使用原地址"}).then(function(){t.addEstateSubdistrict(2)}).catch(function(e){"cancel"===e&&t.addEstateSubdistrict(3)})})},clearAddress:function(){this.$emit("addressChange",{address:"",regionAddressId:""})}},watch:{mapModelVisible:function(e){var t=this;e?this.$nextTick(function(){t.tempAreaCode=Object(m.d)(t.areaCode),t.initBMap()}):(this.$set(this,"mapSelectForm",{}),this.searchKeywords="",this.searchResult=[],this.$refs.popover.doClose())},value:{immediate:!0,handler:function(e){this.specificAddress=e}},"mapSelectForm.region":function(e,t){e!==t&&e&&(this.tempAreaCode[2]=e)}}}},nySD:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tooltip",{staticClass:"item",attrs:{disabled:!e.specificAddress,effect:"dark",content:e.specificAddress,placement:"top-start"}},[a("el-select",{staticClass:"map-address-select",attrs:{filterable:"",remote:"",clearable:!0,placeholder:"请输入关键词","remote-method":e.fetchAddressList,loading:e.loading,"popper-append-to-body":!1},on:{focus:e.checkAddressSelect,clear:e.clearAddress},model:{value:e.specificAddress,callback:function(t){e.specificAddress=t},expression:"specificAddress"}},e._l(e.addressList,function(t,s){return a("el-option",{key:s,attrs:{value:t.formatName},domProps:{innerHTML:e._s(t.displayText)},nativeOn:{click:function(a){e.setAddress(t)}}})}))],1),e._v(" "),a("el-dialog",{attrs:{title:"地图选择小区",visible:e.mapModelVisible,width:"700px","append-to-body":!0},on:{"update:visible":function(t){e.mapModelVisible=t}}},[a("el-card",{staticClass:"map-selected-tips",attrs:{"body-style":{padding:"10px"}}},[a("p",[e._v("1. 如果搜索的内容在右侧列表中小区名称不对（例如：天天超市），点击后可以自定义小区名称、具体位置、所在区域。")]),e._v(" "),a("p",[e._v("2. 如果搜索的内容在右侧列表中查询不到，请通过鼠标手动定位房源位置，自定义小区名称、具体位置、所在区域。")])]),e._v(" "),a("div",{staticClass:"map-selected-container"},[a("div",{ref:"bmContainer",staticClass:"bm-container"},[a("div",{staticClass:"bm-view",attrs:{id:"bm-view"}}),e._v(" "),a("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入公寓地址",clearable:"",size:"small"},nativeOn:{keyup:function(t){e.searchPositionByKeywords(t)}},model:{value:e.searchKeywords,callback:function(t){e.searchKeywords=t},expression:"searchKeywords"}}),e._v(" "),a("el-popover",{ref:"popover",attrs:{"popper-class":"selected-house-position",placement:"bottom",width:"360",trigger:"manual"}},[a("el-form",{ref:"mapSelectForm",attrs:{"label-position":"right","label-width":"80px",model:e.mapSelectForm,rules:e.mapSelectFormRules,size:"mini"}},[a("i",{staticClass:"el-icon-close close-icon",on:{click:function(t){e.$refs.popover.doClose()}}}),e._v(" "),a("el-form-item",{staticClass:"form-item"},[a("div",{staticClass:"city-label",attrs:{slot:"label"},slot:"label"},[e._v("当前城市")]),e._v(" "),a("p",{staticClass:"city-name"},[e._v(e._s(e.mapSelectForm.city))])]),e._v(" "),a("el-form-item",{staticClass:"form-item",attrs:{label:"所在区域",prop:"region"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.mapSelectForm.region,callback:function(t){e.$set(e.mapSelectForm,"region",t)},expression:"mapSelectForm.region"}},e._l(e.regionOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{staticClass:"form-item",attrs:{label:"小区名称",prop:"name"}},[a("el-input",{model:{value:e.mapSelectForm.name,callback:function(t){e.$set(e.mapSelectForm,"name",t)},expression:"mapSelectForm.name"}})],1),e._v(" "),a("el-form-item",{staticClass:"form-item",attrs:{label:"具体地址",prop:"address"}},[a("el-input",{model:{value:e.mapSelectForm.address,callback:function(t){e.$set(e.mapSelectForm,"address",t)},expression:"mapSelectForm.address"}})],1)],1),e._v(" "),a("div",{staticClass:"selected-point",attrs:{slot:"reference"},slot:"reference"})],1)],1),e._v(" "),a("el-card",{staticClass:"search-list",attrs:{"body-style":{padding:"10px 0"}}},e._l(e.searchResult,function(t,s){return a("a",{key:s,staticClass:"search-list-item",on:{click:function(a){e.setMapPosition(t.point,t)}}},[a("p",{staticClass:"title"},[e._v(e._s(t.title))]),e._v(" "),a("p",{staticClass:"address"},[e._v(e._s(t.address))])])}))],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.closeMapModel}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.closeMapModel("save")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]}}});